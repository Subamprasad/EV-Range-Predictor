<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EV Range Prediction</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        body {
            background-color: #0f172a;
            color: #e2e8f0;
            font-family: 'Inter', sans-serif;
        }

        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .input-field {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(148, 163, 184, 0.2);
            color: white;
            padding-right: 2.5rem;
        }

        .input-field:focus {
            border-color: #2563eb;
            /* Blue 600 - Matches User Request */
            outline: none;
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        /* Custom Dropdown Styles */
        .dropdown-wrapper {
            position: relative;
        }

        .dropdown-list {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #1e293b;
            border: 1px solid #475569;
            border-radius: 0.5rem;
            margin-top: 0.25rem;
            max-height: 250px;
            overflow-y: auto;
            z-index: 50;
            display: none;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
        }

        .dropdown-list.show {
            display: block;
        }

        .dropdown-item {
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: background 0.15s;
            border-bottom: 1px solid #334155;
            color: #e2e8f0;
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .dropdown-item:hover {
            background: #2563eb;
            /* Blue 600 */
            color: white;
        }

        .dropdown-item.selected {
            background: #2563eb;
            /* Blue 600 */
            color: white;
        }

        /* Scrollbar styling */
        .dropdown-list::-webkit-scrollbar {
            width: 8px;
        }

        .dropdown-list::-webkit-scrollbar-track {
            background: #0f172a;
        }

        .dropdown-list::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 4px;
        }
    </style>
</head>

<body class="min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-slate-900 to-slate-800">

    <div class="glass-panel w-full max-w-2xl rounded-2xl shadow-2xl p-8 relative overflow-hidden">
        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-400 to-indigo-500"></div>

        <h1
            class="text-3xl font-bold text-center mb-2 text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-indigo-400">
            EV Range Predictor
        </h1>
        <p class="text-slate-400 text-center mb-8">Estimate your electric vehicle's range with AI</p>

        <form action="/predict" method="post" class="space-y-6" autocomplete="off">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                <!-- Make Dropdown -->
                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-2">Make</label>
                    <select id="makeSelect" name="Make" class="hidden" required>
                        <option value="" disabled selected></option>
                    </select>

                    <div class="dropdown-wrapper">
                        <div class="relative">
                            <input type="text" id="makeInput" placeholder="Select Make" readonly
                                class="input-field w-full px-4 py-3 rounded-xl transition-all cursor-pointer bg-slate-800 focus:bg-slate-700">
                            <div
                                class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-slate-400">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </div>
                        </div>
                        <div id="makeList" class="dropdown-list"></div>
                    </div>
                </div>

                <!-- Model Dropdown -->
                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-2">Model</label>
                    <select id="modelSelect" name="Model" class="hidden" required>
                        <option value="" disabled selected></option>
                    </select>

                    <div class="dropdown-wrapper">
                        <div class="relative">
                            <input type="text" id="modelInput" placeholder="Select Model" disabled
                                class="input-field w-full px-4 py-3 rounded-xl transition-all opacity-50 cursor-not-allowed">
                            <div
                                class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-slate-400">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </div>
                        </div>
                        <div id="modelList" class="dropdown-list"></div>
                    </div>
                </div>

                <!-- Model Year Dropdown -->
                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-2">Model Year</label>
                    <select id="yearSelect" name="Model Year" class="hidden" required>
                        <option value="" disabled selected></option>
                    </select>

                    <div class="dropdown-wrapper">
                        <div class="relative">
                            <input type="text" id="yearInput" placeholder="Select Year" disabled
                                class="input-field w-full px-4 py-3 rounded-xl transition-all opacity-50 cursor-not-allowed">
                            <div
                                class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-slate-400">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </div>
                        </div>
                        <div id="yearList" class="dropdown-list"></div>
                    </div>
                </div>

                <!-- EV Type Dropdown -->
                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-2">EV Type</label>
                    <select id="evTypeSelect" name="Electric Vehicle Type" class="hidden" required>
                        <option value="" disabled selected></option>
                    </select>

                    <div class="dropdown-wrapper">
                        <div class="relative">
                            <input type="text" id="evTypeInput" placeholder="Select EV Type" readonly
                                class="input-field w-full px-4 py-3 rounded-xl transition-all cursor-pointer bg-slate-800 focus:bg-slate-700">
                            <div
                                class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-slate-400">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </div>
                        </div>
                        <div id="evTypeList" class="dropdown-list"></div>
                    </div>
                </div>

                <!-- Legislative District Dropdown -->
                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-2">Legislative District</label>
                    <select id="districtSelect" name="Legislative District" class="hidden" required>
                        <option value="" disabled selected></option>
                    </select>

                    <div class="dropdown-wrapper">
                        <div class="relative">
                            <input type="text" id="districtInput" placeholder="Select District" readonly
                                class="input-field w-full px-4 py-3 rounded-xl transition-all cursor-pointer bg-slate-800 focus:bg-slate-700">
                            <div
                                class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-slate-400">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </div>
                        </div>
                        <div id="districtList" class="dropdown-list"></div>
                    </div>
                </div>
            </div>

            <button type="submit"
                class="btn-primary w-full py-4 rounded-xl font-bold text-white text-lg mt-8 shadow-lg">
                Predict Range
            </button>
        </form>

        {% if prediction_text %}
        <div class="mt-8 p-6 bg-slate-800/50 rounded-xl border border-blue-500/20 text-center animate-pulse shadow-2xl">
            <p class="text-slate-400 text-sm uppercase tracking-wider mb-1">Estimated Range</p>
            <h2 class="text-4xl font-bold text-blue-400">{{ prediction_text }} <span
                    class="text-lg text-slate-500">miles</span></h2>
        </div>
        {% endif %}
    </div>

    <!-- Hidden Data Store to prevent IDE Syntax Errors with Jinja -->
    <div id="app-data" style="display:none;" data-map='{{ data_map|default({})|tojson|safe }}'
        data-ev-types='{{ ev_types|default([])|tojson|safe }}' data-districts='{{ districts|default([])|tojson|safe }}'
        data-pre-make="{{ selected_make }}" data-pre-model="{{ selected_model }}" data-pre-year="{{ selected_year }}"
        data-pre-ev-type="{{ selected_ev_type }}" data-pre-district="{{ selected_district }}">
    </div>

    <script>
        const d = document.getElementById('app-data').dataset;
        const dataMap = JSON.parse(d.map), evTypes = JSON.parse(d.evTypes), districts = JSON.parse(d.districts);
        const preSelected = { make: d.preMake, model: d.preModel, year: d.preYear, evType: d.preEvType, district: d.preDistrict };

        class CustomDropdown {
            constructor(a, b, c, d = [], e = null) { this.input = document.getElementById(a), this.list = document.getElementById(b), this.select = document.getElementById(c), this.options = d, this.onSelect = e, this.init() }
            init() {
                this.render(this.options);
                this.input.addEventListener('click', e => {
                    if (!this.input.disabled) {
                        e.stopPropagation(), this.closeAll(this.list);
                        this.list.classList.toggle('show') ? (this.input.removeAttribute('readonly'), this.input.focus()) : this.input.setAttribute('readonly', !0); this.render(this.options)
                    }
                });
                this.input.addEventListener('input', e => { const t = e.target.value.toLowerCase(); this.render(this.options.filter(o => String(o).toLowerCase().includes(t))), this.list.classList.add('show') });
                document.addEventListener('click', e => { this.input.contains(e.target) || this.list.contains(e.target) || (this.list.classList.remove('show'), this.input.setAttribute('readonly', !0)) })
            }
            render(t) {
                this.list.innerHTML = '';
                if (!t.length) return this.list.innerHTML = '<div class="dropdown-item text-slate-500 cursor-default">No results</div>';
                t.forEach(e => { const s = document.createElement('div'); s.className = 'dropdown-item' + (String(e) === this.input.value ? ' selected' : ''), s.textContent = e, s.onclick = i => { i.stopPropagation(), this.selectItem(e) }, this.list.appendChild(s) })
            }
            selectItem(e) { this.input.value = e, this.list.classList.remove('show'), this.input.setAttribute('readonly', !0), this.select.innerHTML = `<option value="${e}" selected>${e}</option>`, this.onSelect && this.onSelect(e) }
            setOptions(e) { this.options = e, this.render(e) }
            enable() { this.input.disabled = !1, this.input.classList.remove('opacity-50', 'cursor-not-allowed'), this.input.placeholder = "Select..." }
            disable() { this.input.disabled = !0, this.input.classList.add('opacity-50', 'cursor-not-allowed'), this.input.value = '', this.input.placeholder = "Select Previous...", this.options = [], this.render([]) }
            setValue(e) { e && "None" !== e && (this.input.value = e, this.select.innerHTML = `<option value="${e}" selected>${e}</option>`) }
            closeAll(e) { document.querySelectorAll('.dropdown-list').forEach(t => { t !== e && t.classList.remove('show') }) }
        }

        const makeD = new CustomDropdown('makeInput', 'makeList', 'makeSelect', Object.keys(dataMap).sort(), e => { modelD.disable(), yearD.disable(); if (dataMap[e]) { modelD.setOptions(Object.keys(dataMap[e]).sort()), modelD.enable() } });
        const modelD = new CustomDropdown('modelInput', 'modelList', 'modelSelect', [], e => { yearD.disable(); const m = document.getElementById('makeSelect').value; if (m && dataMap[m] && dataMap[m][e]) { yearD.setOptions(dataMap[m][e]), yearD.enable() } });
        const yearD = new CustomDropdown('yearInput', 'yearList', 'yearSelect', []);
        const evD = new CustomDropdown('evTypeInput', 'evTypeList', 'evTypeSelect', evTypes);
        const distD = new CustomDropdown('districtInput', 'districtList', 'districtSelect', districts);

        if (preSelected.make && "None" !== preSelected.make) {
            makeD.setValue(preSelected.make);
            if (dataMap[preSelected.make]) {
                modelD.setOptions(Object.keys(dataMap[preSelected.make]).sort()), modelD.enable();
                if (preSelected.model && "None" !== preSelected.model) {
                    modelD.setValue(preSelected.model);
                    const y = dataMap[preSelected.make][preSelected.model];
                    y && (yearD.setOptions(y), yearD.enable(), yearD.setValue(preSelected.year))
                }
            }
        }
        evD.setValue(preSelected.evType), distD.setValue(preSelected.district);
    </script>
</body>

</html>